const {
    time,
    loadFixture,
} = require("@nomicfoundation/hardhat-network-helpers");
const { anyValue } = require("@nomicfoundation/hardhat-chai-matchers/withArgs");
const { expect } = require("chai");

describe("1024 Pixels", function () {
    function toHex(n) {
        let s = n.toString(16);
        while (s.length < 2) {
            s = '0' + s;
        }
        return s;
    }

    const TOKEN_ID = '0xa3be5d9d2688e74ee8d209bbd17809a98de3791af73de52d5a0b07023454a38e';
    const PIXELS = '0x030500020201020403010200030204050104040102050500040503040401010105000102020003020004050503000005010401020005030005040105030104040502000100030105040501020403040100010200010102040201030200000005030003010005020105040003040000050302040304010205050004010003010201010101020104000405000100050301040002040300030301010100020201030101040504010304050302000005030501050404010501040102040201040405050002030002040404000500010205050002050305020302030402020503030002030001020100050500000004010303010202010205020300040202000301010001020102030100010004000203020001000301040102040402010502000000040104040503040004010404020401030303000205000302050405040002030300020203020103040400040003000004010000020104000303030003010102050103040401050301010404040501010505030005010000040000020401010201030205050305030401050304000400040405020103030500030300020103020304000101050403020405010500040505020003020505010502000503020104020100010204000001040401020101040402040200010303050403050505050304040204020400050305030501030005000500020502030503030003050500050301040003010500020105020103010202050402030002010504030002050303010402050402040103030500030201030301040402030204010302000101040005050003010200010501000002020401050404020404020202030004000403030502010200010502050004010104010502010202000005010501050001000001032f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f2f0304030001010504040103000205000501000002010202010201040203000201020304010405010300030102010501040504020502020500040402050304010300000504010304010005040000030105000305000302020104040105010500030102010005020503040504020102030200020505040303030300030301040002010401010004040101010105000001000002000402000304040102050000000503000203000003010302030505010504030103010305020501030003020005030200040200040100000305020403050101050203000100010301000105030500';

    // We define a fixture to reuse the same setup in every test.
    // We use loadFixture to run this setup once, snapshot that state,
    // and reset Hardhat Network to that snapshot in every test.
    async function deployPixelsFixture() {
        // Contracts are deployed using the first signer/account by default
        const [owner, otherAccount] = await ethers.getSigners();
        const PixelArt = await ethers.getContractFactory("PixelArt");
        const contract = await PixelArt.deploy("1024 Pixels", "1KP");

        return contract;
    }

    describe("Deployment", function () {
        it("Should mint ok", async function () {
            const contract = await loadFixture(deployPixelsFixture);
            await contract.mint(PIXELS);
            expect(await contract.imageURI(TOKEN_ID)).to.equals('data:image/gif;base64,R0lGODlhIAAgAPUvAP+AgP//gID/gAD/gID//wCA//+AwP+A//8AAP//AID/AAD/QAD//wCAwICAwP8A/4BAQP+AQAD/AACAgABAgICA/4AAQP8AgIAAAP+AAACAAACAQAAA/wAAoIAAgIAA/0AAAIBAAABAAABAQAAAgAAAQEAAQEAAgAAAAICAAICAQICAgECAgMDAwP///xERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERESH5BAEAAC8ALAAAAAAgACAAAAchgAMFAAICAQIEAwECAAMCBAUBBAQBAgUFAAQFAwQEAQEBIYAFAAECAgADAgAEBQUDAAAFAQQBAgAFAwAFBAEFAwEEBCGABQIAAQADAQUEBQECBAMEAQABAgABAQIEAgEDAgAAAAUhgAMAAwEABQIBBQQAAwQAAAUDAgQDBAECBQUABAEAAwECIYABAQEBAgEEAAQFAAEABQMBBAACBAMAAwMBAQEAAgIBAyGAAQEEBQQBAwQFAwIAAAUDBQEFBAQBBQEEAQIEAgEEBAUhgAUAAgMAAgQEBAAFAAECBQUAAgUDBQIDAgMEAgIFAwMAIYACAwABAgEABQUAAAAEAQMDAQICAQIFAgMABAICAAMBASGAAAECAQIDAQABAAQAAgMCAAEAAwEEAQIEBAIBBQIAAAAhgAQBBAQFAwQABAEEBAIEAQMDAwACBQADAgUEBQQAAgMDIYAAAgIDAgEDBAQABAADAAAEAQAAAgEEAAMDAwADAQECBSGAAQMEBAEFAwEBBAQEBQEBBQUDAAUBAAAEAAACBAEBAgEhgAMCBQUDBQMEAQUDBAAEAAQEBQIBAwMFAAMDAAIBAwIDIYAEAAEBBQQDAgQFAQUABAUFAgADAgUFAQUCAAUDAgEEAiGAAQABAgQAAAEEBAECAQEEBAIEAgABAwMFBAMFBQUFAwQhgAQCBAIEAAUDBQMFAQMABQAFAAIFAgMFAwMAAwUFAAUDIYABBAADAQUAAgEFAgEDAQICBQQCAwACAQUEAwACBQMDASGABAIFBAIEAQMDBQADAgEDAwEEBAIDAgQBAwIAAQEEAAUhgAUAAwECAAEFAQAAAgIEAQUEBAIEBAICAgMABAAEAwMFIYACAQIAAQUCBQAEAQEEAQUCAQICAAAFAQUBBQABAAABAyGALy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8hgC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vIYAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLyGALy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8hgC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vIYADBAMAAQEFBAQBAwACBQAFAQAAAgECAgECAQQCAwACASGAAgMEAQQFAQMAAwECAQUBBAUEAgUCAgUABAQCBQMEAQMhgAAABQQBAwQBAAUEAAADAQUAAwUAAwICAQQEAQUBBQADIYABAgEABQIFAwQFBAIBAgMCAAIFBQQDAwMDAAMDAQQAAiGAAQQBAQAEBAEBAQEFAAABAAACAAQCAAMEBAECBQAAAAUhgAMAAgMAAAMBAwIDBQUBBQQDAQMBAwUCBQEDAAMCAAUDIYACAAQCAAQBAAADBQIEAwUBAQUCAwABAAEDAQABBQMFAAGBADs=');
            expect(await contract.tokenURI(TOKEN_ID)).to.equals('data:application/json;base64,eyJuYW1lIjoiMTAyNCBQaXhlbHMgIyA3NDA2MzM0MTM2MDU2MDM3ODUyODkyMDMzODIxMTQ5MTYwMTM3NTUzMTEwNDM2ODI2MDE4OTEzMTY4ODg0NDY0NzIwMjk4OTMxOTA1NCIsImltYWdlIjoiZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoSUFBZ0FQVXZBUCtBZ1AvL2dJRC9nQUQvZ0lELy93Q0EvLytBd1ArQS8vOEFBUC8vQUlEL0FBRC9RQUQvL3dDQXdJQ0F3UDhBLzRCQVFQK0FRQUQvQUFDQWdBQkFnSUNBLzRBQVFQOEFnSUFBQVArQUFBQ0FBQUNBUUFBQS93QUFvSUFBZ0lBQS8wQUFBSUJBQUFCQUFBQkFRQUFBZ0FBQVFFQUFRRUFBZ0FBQUFJQ0FBSUNBUUlDQWdFQ0FnTURBd1AvLy94RVJFUkVSRVJFUkVSRVJFUkVSRVJFUkVSRVJFUkVSRVJFUkVSRVJFUkVSRVJFUkVSRVJFUkVSRVJFUkVSRVJFUkVSRVNINUJBRUFBQzhBTEFBQUFBQWdBQ0FBQUFjaGdBTUZBQUlDQVFJRUF3RUNBQU1DQkFVQkJBUUJBZ1VGQUFRRkF3UUVBUUVCSVlBRkFBRUNBZ0FEQWdBRUJRVURBQUFGQVFRQkFnQUZBd0FGQkFFRkF3RUVCQ0dBQlFJQUFRQURBUVVFQlFFQ0JBTUVBUUFCQWdBQkFRSUVBZ0VEQWdBQUFBVWhnQU1BQXdFQUJRSUJCUVFBQXdRQUFBVURBZ1FEQkFFQ0JRVUFCQUVBQXdFQ0lZQUJBUUVCQWdFRUFBUUZBQUVBQlFNQkJBQUNCQU1BQXdNQkFRRUFBZ0lCQXlHQUFRRUVCUVFCQXdRRkF3SUFBQVVEQlFFRkJBUUJCUUVFQVFJRUFnRUVCQVVoZ0FVQUFnTUFBZ1FFQkFBRkFBRUNCUVVBQWdVREJRSURBZ01FQWdJRkF3TUFJWUFDQXdBQkFnRUFCUVVBQUFBRUFRTURBUUlDQVFJRkFnTUFCQUlDQUFNQkFTR0FBQUVDQVFJREFRQUJBQVFBQWdNQ0FBRUFBd0VFQVFJRUJBSUJCUUlBQUFBaGdBUUJCQVFGQXdRQUJBRUVCQUlFQVFNREF3QUNCUUFEQWdVRUJRUUFBZ01ESVlBQUFnSURBZ0VEQkFRQUJBQURBQUFFQVFBQUFnRUVBQU1EQXdBREFRRUNCU0dBQVFNRUJBRUZBd0VCQkFRRUJRRUJCUVVEQUFVQkFBQUVBQUFDQkFFQkFnRWhnQU1DQlFVREJRTUVBUVVEQkFBRUFBUUVCUUlCQXdNRkFBTURBQUlCQXdJRElZQUVBQUVCQlFRREFnUUZBUVVBQkFVRkFnQURBZ1VGQVFVQ0FBVURBZ0VFQWlHQUFRQUJBZ1FBQUFFRUJBRUNBUUVFQkFJRUFnQUJBd01GQkFNRkJRVUZBd1FoZ0FRQ0JBSUVBQVVEQlFNRkFRTUFCUUFGQUFJRkFnTUZBd01BQXdVRkFBVURJWUFCQkFBREFRVUFBZ0VGQWdFREFRSUNCUVFDQXdBQ0FRVUVBd0FDQlFNREFTR0FCQUlGQkFJRUFRTURCUUFEQWdFREF3RUVCQUlEQWdRQkF3SUFBUUVFQUFVaGdBVUFBd0VDQUFFRkFRQUFBZ0lFQVFVRUJBSUVCQUlDQWdNQUJBQUVBd01GSVlBQ0FRSUFBUVVDQlFBRUFRRUVBUVVDQVFJQ0FBQUZBUVVCQlFBQkFBQUJBeUdBTHk4dkx5OHZMeTh2THk4dkx5OHZMeTh2THk4dkx5OHZMeTh2THk4dkx5OGhnQzh2THk4dkx5OHZMeTh2THk4dkx5OHZMeTh2THk4dkx5OHZMeTh2THk4dklZQXZMeTh2THk4dkx5OHZMeTh2THk4dkx5OHZMeTh2THk4dkx5OHZMeTh2THlHQUx5OHZMeTh2THk4dkx5OHZMeTh2THk4dkx5OHZMeTh2THk4dkx5OHZMeThoZ0M4dkx5OHZMeTh2THk4dkx5OHZMeTh2THk4dkx5OHZMeTh2THk4dkx5OHZJWUFEQkFNQUFRRUZCQVFCQXdBQ0JRQUZBUUFBQWdFQ0FnRUNBUVFDQXdBQ0FTR0FBZ01FQVFRRkFRTUFBd0VDQVFVQkJBVUVBZ1VDQWdVQUJBUUNCUU1FQVFNaGdBQUFCUVFCQXdRQkFBVUVBQUFEQVFVQUF3VUFBd0lDQVFRRUFRVUJCUUFESVlBQkFnRUFCUUlGQXdRRkJBSUJBZ01DQUFJRkJRUURBd01EQUFNREFRUUFBaUdBQVFRQkFRQUVCQUVCQVFFRkFBQUJBQUFDQUFRQ0FBTUVCQUVDQlFBQUFBVWhnQU1BQWdNQUFBTUJBd0lEQlFVQkJRUURBUU1CQXdVQ0JRRURBQU1DQUFVRElZQUNBQVFDQUFRQkFBQURCUUlFQXdVQkFRVUNBd0FCQUFFREFRQUJCUU1GQUFHQkFEcz0ifQ==');
        });

        it("Should mint failed: invalid color", async function () {
            const contract = await loadFixture(deployPixelsFixture);
            await expect(contract.mint('0x30' + PIXELS.substring(4))).to.be.revertedWith('invalid pixel index color');
        });

        it("Should mint failed: invalid length", async function () {
            const contract = await loadFixture(deployPixelsFixture);
            await expect(contract.mint('0x01020304')).to.be.revertedWith('invalid pixels length');
        });

        it("Should mint failed: already minted", async function () {
            const contract = await loadFixture(deployPixelsFixture);
            await contract.mint(PIXELS);
            await expect(contract.mint(PIXELS)).to.be.revertedWith('ERC721: token already minted');
        });
    });
});
